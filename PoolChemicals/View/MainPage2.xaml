<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:editors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"             
             xmlns:gauge="clr-namespace:Syncfusion.Maui.Gauges;assembly=Syncfusion.Maui.Gauges"
             xmlns:viewmodel="clr-namespace:PoolChemicals.ViewModel"
             x:Class="PoolChemicals.MainPage"
             x:DataType="viewmodel:MainViewModel">

    <!--

                 xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"             
             xmlns:controls="clr-namspace:PoolChemicals.ContentViews"

    -->

    <ScrollView>
        <VerticalStackLayout>
            <HorizontalStackLayout>
                <Label VerticalTextAlignment="Center">
                    <Label.Text>
                        <MultiBinding StringFormat="Version: {0}.{1}">
                            <Binding Path="AppVersion"/>
                            <Binding Path="AppBuild"/>
                        </MultiBinding>
                    </Label.Text>
                </Label>
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label>
                    <Label.Text>
                        <MultiBinding StringFormat="Pool Volume: {0} {1}">
                            <Binding Path="Settings.Volume"/>
                            <Binding Path="Settings.SizeUnit"/>
                        </MultiBinding>
                    </Label.Text>
                </Label>
            </HorizontalStackLayout>
            <HorizontalStackLayout>

                <Label Text="Water Tempurature: "/>
                <editors:SfNumericEntry x:Name="WaterTempEntry" 
                                        Minimum="50" Maximum="100"
                                        MaximumNumberDecimalDigits="0" 
                                        FontSize="15" FontAttributes="Bold"
                                        AllowNull="False"
                                        HorizontalTextAlignment="Center"
                                        Value="{Binding WaterTemp}"
                                        ReturnCommand="{Binding EnterWaterTempCommand}"/>
                <Label Text="{Binding Settings.TempUnit}"/>

            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Show in-range recommendataions: "/>
                <CheckBox x:Name="CheckBoxTarget"                          
                          IsChecked="{Binding ShowInRange}"
                          VerticalOptions="Center"
                          HorizontalOptions="Start"
                          Margin="10,0,0,0">

                </CheckBox>
            </HorizontalStackLayout>
            <VerticalStackLayout IsVisible="false">
                <Label Text="{Binding WaterTemp}"/>
                <Label Text="{Binding SaltReading}"/>
                <Label Text="{Binding FCReading}"/>
                <Label Text="{Binding PHReading}"/>
                <Label Text="{Binding AlkalineReading}"/>
                <Label Text="{Binding CalciumReading}"/>
                <Label Text="{Binding CYAReading}"/>
                <Label Text="{Binding BorateReading}"/>
            </VerticalStackLayout>

            <!-- CSI Grid-->
            <Grid Padding="0,5">
                <Border Stroke="Black" Margin="5,0,5,0"
                        BackgroundColor="White">
                    <VerticalStackLayout Padding="10">

                        <Label Text="Saturation Index Calculation requires pH, Alkaline, Calcium, CYA, Borate*, Salt and Water Tempurature.
Results less than -0.6 can cause problems for plaster, tile, stone, and pebble pools.
Greater than 0.6 can lead to problems for all pools. *If used.&#10;"
                               FontSize="15" FontAttributes="Bold"/>
                        <Grid ColumnDefinitions="*,*"
                          RowDefinitions="*"
                          Padding="10">
                            <Label HorizontalOptions="Center" 
                               Grid.Column="0"
                               TextColor="Blue"
                               Text="{Binding SaturationIndex,StringFormat='Current SI: {0}'}"/>

                            <Label HorizontalOptions="Center"
                               Grid.Column="1"
                               TextColor="Green"
                               Text="{Binding SaturationIndexTarget,StringFormat='Target SI: {0}'}"/>
                        </Grid>
                        <gauge:SfLinearGauge Minimum="-1" 
                                     Maximum="1" 
                                     Interval=".25" 
                                     Scale="1">
                            <gauge:SfLinearGauge.Ranges>
                                <gauge:LinearRange StartValue="-1"
                                  EndValue="-.75"
                                  Fill="Red" />
                                <gauge:LinearRange StartValue="-.75"
                                  EndValue="-.4"
                                  Fill="Orange" />
                                <gauge:LinearRange StartValue="-.4"
                                  EndValue=".4"
                                  Fill="Green" />
                                <gauge:LinearRange StartValue=".4"
                                  EndValue=".75"
                                  Fill="Orange" />
                                <gauge:LinearRange StartValue=".75"
                                  EndValue="1"
                                  Fill="Red" />

                            </gauge:SfLinearGauge.Ranges>
                            <gauge:SfLinearGauge.MarkerPointers>
                                <gauge:LinearShapePointer Value="{Binding SaturationIndex}" IsInteractive="True" 
                                              Fill="Blue"
                                              OffsetY="-5"/>
                                <gauge:LinearShapePointer Value="{Binding SaturationIndexTarget}" IsInteractive="True" 
                                              Fill="Green"
                                              ShapeType="Triangle"
                                              OffsetY="16"/>
                            </gauge:SfLinearGauge.MarkerPointers>
                        </gauge:SfLinearGauge>
                    </VerticalStackLayout>
                </Border>
            </Grid>

            <!-- Salt Grid-->
            <Grid Padding="0,5">
                <Border Stroke="Black" 
                        Margin="5,0,5,0">
                    <Grid ColumnDefinitions="90,70,*"
                          RowDefinitions="*,*"
                          Padding="10">
                        <Border Stroke="Black"
                                Grid.Row="0" Grid.RowSpan="2"
                                Margin="5,0,5,0"
                                BackgroundColor="LightBlue">
                            <VerticalStackLayout>
                                <Label Text="SA"                              
                               FontSize="30" FontAttributes="Bold"
                               HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding SaltRange}" 
                                       FontSize="12" FontAttributes="Bold"
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Settings.SaltTarget,StringFormat='Target: {0}'}"  
                                       FontSize="12" FontAttributes="Bold"
                                       HorizontalTextAlignment="Center"/>
                            
                            </VerticalStackLayout>
                        </Border>

                        <Label Text="Current: "
                               HorizontalTextAlignment="Center"

                               Grid.Row="0" Grid.Column="1"/>
                        <editors:SfNumericEntry Minimum="0" Maximum="5000" MaximumNumberDecimalDigits="0"
                                                FontSize="15" FontAttributes="Bold" 
                                                ReturnType="Default"
                                                IsEnabled="True"

                                                SmallChange="100"
                                                UpDownPlacementMode="Inline"
                                                HorizontalTextAlignment="Start" 
                                                VerticalTextAlignment="Start"
                                                Value="{Binding SaltReading}"
                                                Grid.Row="0" Grid.Column="2"
                                                ReturnCommand="{Binding EnterSaltCommand}"/>


                        <Label Text="{Binding SaltResults}"
                               IsVisible="{Binding SaltIsVisible}"
                               Grid.Row="1" Grid.Column="1"  Grid.ColumnSpan="4"/>
                    </Grid>
                </Border>
            </Grid>
            <!-- FC Grid-->
            <Grid Padding="0,5">
                <Border Stroke="Black" Margin="5,0,5,0">
                    <Grid ColumnDefinitions="90,70,*"
                          RowDefinitions="*,*,*"
                          Padding="10" RowSpacing="0" ColumnSpacing="0">
                        <Border Stroke="Black" Margin="5,0,5,0"
                                Grid.Row="0" Grid.RowSpan="2"
                                BackgroundColor="Yellow">
                            <VerticalStackLayout>
                                <Label Text="FC"
                                       HorizontalTextAlignment="Center"
                                       FontSize="30"/>
                                <Label Text="{Binding FCRange}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Settings.FCTarget,StringFormat='Target: {0}'}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>
                        <Label Text="Current: "
                               HorizontalTextAlignment="Center"
                               Grid.Row="0" Grid.Column="1"/>
                        <editors:SfNumericEntry Minimum="0" Maximum="9" MaximumNumberDecimalDigits="1"
                                                FontSize="15" FontAttributes="Bold"                                                
                                                SmallChange=".5"
                                                UpDownPlacementMode="Inline"                    
                                                HorizontalTextAlignment="Start" 
                                                VerticalTextAlignment="Center"
                                                Value="{Binding FCReading}"
                                                
                                                Grid.Row="0" Grid.Column="2"
                                                ReturnCommand="{Binding EnterFCCommand}"/>

                        <Label Text="{Binding FCResults}"
                            IsVisible="{Binding FCIsVisible}"
                               Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3">
                            <!--<Label.Text>
                                <MultiBinding StringFormat="Add {0} oz of {2}% Bleach">
                                    <Binding Path="AddBleach"/>
                                    <Binding Path="AddBleach"/>
                                    <Binding Path="Bleach"/>
                                </MultiBinding>
                            </Label.Text>-->
                        </Label>
                        <!--<Label IsVisible="{Binding FCCIsVisible}"
                               FontSize="15" FontAttributes="Bold"
                               Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="5">
                            -->
                        <!--<Label.Text>
                                <MultiBinding StringFormat="Add {0} oz by weight or {1} oz by volume of {2}.">
                                    <Binding Path="ByWeight"/>
                                    <Binding Path="ByVolume"/>
                                    <Binding Path="ChlorinePickerSelection"/>
                                </MultiBinding>
                            </Label.Text>-->
                        <!--
                        </Label>-->

                        <Label IsVisible="{Binding FCNoteIsVisible}"
                               Text="Note: Dichlor and Trichlor increses CYA and lower pH, while Cal-hypo will add Calcium."
                               Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="5"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- pH Grid-->
            <Grid Padding="0,5">
                <Border Stroke="Black"  Margin="5,0,5,0">
                    <Grid ColumnDefinitions="90,70,*"
                          RowDefinitions="*,*,*"
                          Padding="10" RowSpacing="0" ColumnSpacing="0">
                        <Border Stroke="Black" Margin="5,0,5,0"
                                Grid.Row="0" Grid.RowSpan="2"
                                BackgroundColor="Orange">
                            <VerticalStackLayout>
                                <Label Text="pH"
                               HorizontalTextAlignment="Center"
                               FontSize="30"/>
                                <Label Text="{Binding PHRange}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Settings.PHTarget,StringFormat='Target: {0}'}"
                                       FontSize="12" 
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>
                        <Label Text="Current: "
                               HorizontalTextAlignment="Center"
                               Grid.Row="0" Grid.Column="1"/>
                        <editors:SfNumericEntry Minimum="6" Maximum="9" MaximumNumberDecimalDigits="1"
                                                FontSize="15" FontAttributes="Bold"
                                                SmallChange=".2"
                                                UpDownPlacementMode="Inline"                                                                                             
                                                HorizontalTextAlignment="Start" 
                                                VerticalTextAlignment="Center"
                                                Value="{Binding PHReading}"
                                                Grid.Row="0" Grid.Column="2"
                                                ReturnCommand="{Binding EnterPHCommand}"/>


                        <Label IsVisible="{Binding PHRaiseIsVisible}"
                               Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3">
                            <Label.Text>
                                <MultiBinding StringFormat="With Alkalinity of {0}{1}{2}">
                                    <Binding Path="AlkalineReading"/>
                                    <Binding Path="BorateNote"/>
                                    <Binding Path="PHAdjustment"/>
                                </MultiBinding>
                            </Label.Text>
                        </Label>

                        <Label IsVisible="{Binding PHLowerIsVisible}"
                               Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3"
                               Text="{Binding PHAdjustment}">
                        </Label>


                    </Grid>
                </Border>
            </Grid>

            <!-- Alkaline Grid-->
            <Grid Padding="0,5">
                <Border Stroke="Black"  Margin="5,0,5,0" >
                    <Grid ColumnDefinitions="90,70,*"
                          RowDefinitions="*,*,*"
                          Padding="10" RowSpacing="0" ColumnSpacing="0">
                        <Border Stroke="Black" Margin="5,0,5,0"
                                Grid.Row="0" Grid.RowSpan="2"
                                BackgroundColor="LightGreen">
                            <VerticalStackLayout>
                                <Label Text="AL"
                               HorizontalTextAlignment="Center"
                               FontSize="30"/>
                                <Label Text="{Binding AlkalineRange}"
                                       FontSize="12" 
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Settings.AlkalineTarget,StringFormat='Target: {0}'}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>
                        <Label Text="Current:"
                               HorizontalTextAlignment="Center"
                               Grid.Row="0" Grid.Column="1"/>
                        <editors:SfNumericEntry Minimum="0" Maximum="140" MaximumNumberDecimalDigits="0"
                                                FontSize="15" FontAttributes="Bold"
                                                SmallChange="10"
                                                UpDownPlacementMode="Inline"                                                
                                                HorizontalTextAlignment="Start" 
                                                VerticalTextAlignment="Center"
                                                Value="{Binding AlkalineReading}"
                                                Grid.Row="0" Grid.Column="2"
                                                ReturnCommand="{Binding EnterAlkalineCommand}"/>


                        <Label Text="{Binding BakingSodaAdd}"
                               IsVisible="{Binding AlkalineIsVisible}"
                               Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="5"/>

                        <Label Text="{Binding AlkalineNote}"
                               IsVisible="{Binding AlkalineNoteIsVisible}"
                               Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="5"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- Calcium Grid-->
            <Grid Padding="0,5">
                <Border Stroke="Black"
                        Margin="5,0,5,0"
                        BackgroundColor="White">
                    <Grid ColumnDefinitions="90,70,*"
                          RowDefinitions="*,*,*"
                          Padding="10" RowSpacing="0" ColumnSpacing="0">

                        <Border Stroke="Black" Margin="5,0,5,0"
                                Grid.Row="0" Grid.RowSpan="2"
                                BackgroundColor="LightSalmon">
                            <VerticalStackLayout>
                                <Label Text="CA"
                               HorizontalTextAlignment="Center"
                               FontSize="30"/>
                                <Label Text="{Binding CalciumRange}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Settings.CalciumTarget,StringFormat='Target: {0}'}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>
                        <Label Text="Current:"
                               HorizontalTextAlignment="Center"
                               Grid.Row="0" Grid.Column="1"/>
                        <editors:SfNumericEntry Minimum="100" Maximum="600" MaximumNumberDecimalDigits="0"
                                                FontSize="15" FontAttributes="Bold"
                                                SmallChange="10"
                                                UpDownPlacementMode="Inline"                                                
                                                HorizontalTextAlignment="Start" 
                                                VerticalTextAlignment="Center"
                                                
                                                Value="{Binding CalciumReading}"
                                                Grid.Row="0" Grid.Column="2"
                                                ReturnCommand="{Binding EnterCalciumCommand}"/>

                        <Label Text="{Binding CalciumResults}"
                               IsVisible="{Binding CalciumIsVisible}"
                               Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4"/>

                        <Label Text="Note: Watch your CSI when the Calcium reading is near the upper or lower portion of the range."
                               Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="4"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- CYA Grid-->
            <Grid Padding="0,5">
                <Border Stroke="Black"
                    Margin="5,0,5,0">
                    <Grid ColumnDefinitions="90,70,*"
                          RowDefinitions="*,*,*"
                          Padding="10" RowSpacing="0" ColumnSpacing="0">

                        <Border Stroke="Black" Margin="5,0,5,0"
                                Grid.Row="0" Grid.RowSpan="2"
                                BackgroundColor="Cyan">
                            <VerticalStackLayout>
                                <Label Text="CYA"
                               HorizontalTextAlignment="Center"
                               FontSize="30"
                               Grid.Row="1" Grid.Column="0"/>
                                <Label Text="{Binding CYARange}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Settings.CYATarget,StringFormat='Target: {0}'}"
                                       FontSize="12"
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>
                        <Label Text="Current:"
                               HorizontalTextAlignment="Center"
                               Grid.Row="0" Grid.Column="1"/>
                        <editors:SfNumericEntry Minimum="0" Maximum="100" MaximumNumberDecimalDigits="0"
                                                FontSize="15" FontAttributes="Bold"
                                                SmallChange="5"
                                                UpDownPlacementMode="Inline"                                                
                                                HorizontalTextAlignment="Start" 
                                                VerticalTextAlignment="Center"
                                                Value="{Binding CYAReading}"
                                                Grid.Row="0" Grid.Column="2"
                                                ReturnCommand="{Binding EnterCYACommand}"/>


                        <Label Text="{Binding CYAResults}"
                               IsVisible="{Binding CYAIsVisible}"
                               Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="5"/>

                        <Label Text="Note: It can take solid stabilizer 24 to 48 hours to dissolve."                               
                               IsVisible="{Binding CYANotesIsVisible}" 
                               Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="4"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- Borate Grid-->
            <Grid Padding="0,5" IsVisible="{Binding IncludeBorate}">
                <Border Stroke="Black" 
                        Margin="5,0,5,0">
                    <Grid ColumnDefinitions="90,70,*"
                          RowDefinitions="*,*,*"
                          Padding="10" RowSpacing="0" ColumnSpacing="0">
                        <Border Stroke="Black" Margin="5,0,5,0"
                                Grid.Row="0" Grid.RowSpan="2"
                                BackgroundColor="LightGray">
                            <VerticalStackLayout>
                                <Label Text="BO"
                                        HorizontalTextAlignment="Center"
                                        FontSize="30" 
                                       Grid.Row="1" Grid.Column="0"/>
                                <Label Text="{Binding BorateRange}"
                                        FontSize="12" 
                                       HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Settings.BorateTarget,StringFormat='Target: {0}'}"
                                        FontSize="12" 
                                       HorizontalTextAlignment="Center"/>
                            </VerticalStackLayout>
                        </Border>
                        <Label Text="Current:"
                               HorizontalTextAlignment="Center"
                               Grid.Row="0" Grid.Column="1"/>
                        <editors:SfNumericEntry Minimum="0" Maximum="100" MaximumNumberDecimalDigits="0"
                                        FontSize="15" FontAttributes="Bold"
                                        SmallChange="5"
                                        UpDownPlacementMode="Inline"                                               
                                        HorizontalTextAlignment="Start" 
                                        VerticalTextAlignment="Center"
                                        Value="{Binding BorateReading}"
                                        Grid.Row="0" Grid.Column="2"
                                        ReturnCommand="{Binding EnterBorateCommand}"/>
                        <Label Text="{Binding BorateResults}"
                               IsVisible="{Binding BorateIsVisible}"
                               Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4"/>
                        <Label Text="Note: The pH should be tested and adjusted as needed after increasing the borate level."
                               IsVisible="{Binding BorateIsVisible}"
                               Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="4"/>
                    </Grid>
                </Border>
            </Grid>
            <Grid ColumnDefinitions="*,*" Padding="5" ColumnSpacing="5">
                <Button Text="Calculate All" 
                        Grid.Row="0" Grid.Column="0"
                        Command="{Binding CalculateAllCommand}"/>
                <Button Text="Log Results"
                        Grid.Row="0" Grid.Column="1"
                        IsVisible="true"
                        Command="{Binding LogResultsCommand}"/>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
